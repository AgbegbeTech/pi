<?php
// Root id
$rootId = $comment['root'];
// Count
$count = $comment['count'];
// Target data:
// Title, time, user
// uid, name, avatar, profile_url
$target = $comment['target'];
// Comment list generated by comment module:
// id, time, content, user
// uid, name, avatar, profile_url, IP
$posts = $comment['posts'];
// Pagination object
$paginator = $comment['paginator'];
?>
    <div class="page-header"><?php echo _escape($comment['title']); ?></div>
<?php
if (!$target) {
    echo '<div class="alert">' . __('Item not found.') . '</div>';
    return;
} elseif ($comment['active']) {
    $formData = array(
        'root'      => $comment['root'],
        'redirect'  => $this->url()->requestUri(true),
    );
    $form = Pi::service('comment')->getForm($formData);

    include $this->templateComponent('form');
} else {
    echo '<div class="alert">' . __('Comment is disabled.') . '</div>';
}
?>
    <div class="pi-comment-header">
        <dl class="dl-horizontal">
            <dt><?php _e('Source:') ?></dt>
            <dd><a href="<?php echo $target['url']; ?>" target="_blank" title="<?php echo _escape($target['title']); ?>">
                    <?php echo _escape($target['title']); ?>
                </a>
            </dd>

            <dt><?php _e('Time:') ?></dt>
            <dd><?php echo _date($target['time']); ?></dd>

            <!--
            <dt><?php _e('Author:') ?></dt>
            <dd><a href="<?php echo $target['user']['url']; ?>" target="_blank" title="<?php echo $target['user']['name']; ?>">
                <?php echo $target['user']['name']; ?>
                </a>
            </dd>
            <dt>&nbsp;</dt>
            <dd><?php echo $target['user']['avatar']; ?></dd>
            -->

            <dt><?php _e('Total comments:') ?></dt>
            <dd><?php echo $count; ?></dd>
        </dl>
    </div>
    <div class="pi-comment-list">
<?php
if ($posts) {
    foreach ($posts as $post) {
?>
        <dl class="dl-horizontal pi-comment-post">
            <dt><?php _e('User:') ?></dt>
            <dd><a href="<?php echo $post['user']['url']; ?>" target="_blank" title="<?php echo $post['user']['name']; ?>">
                    <?php echo $post['user']['name']; ?>
                </a>
            </dd>
            <dt>&nbsp;</dt>
            <dd><?php echo $post['user']['avatar']; ?></dd>

            <dt><?php _e('Time:');?></dt>
            <dd><?php echo _date($post['time']); ?></dd>

            <dt><?php _e('Content:');?></dt>
            <dd><?php echo $post['content']; ?></dd>

            <dt><?php _e('Operations:'); ?></dt>
            <dd>
                <?php if (!empty($post['operations'])) { ?>
                    <?php foreach ($post['operations'] as $key => $op) { ?>
                        <a href="<?php echo $op['url']; ?>" title="<?php echo _escape($op['title']); ?>" target="_blank">
                            <?php echo _escape($op['title']); ?>
                        </a>
                    <?php } ?>
                <?php } else { ?>
                    <a href="<?php echo $post['url']; ?>" title="<?php _e('More details'); ?>" target="_blank">
                        <?php _e('More details'); ?>
                    </a>
                <?php } ?>
            </dd>
        </dl>
<?php
    }
?>
    </div>
<?php
    if ($paginator) {
        echo $this->pagination($paginator);
    }
} else {
    _e('No comments available yet.');
}
?>