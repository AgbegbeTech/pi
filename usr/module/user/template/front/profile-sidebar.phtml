<?php
$uid = Pi::user()->getId();
$userName = Pi::user()->get($uid, 'name');
$groups = Pi::registry('display_group', 'user')->read();
array_walk($groups, function (&$group, $gid) {
    $action = $group['compound'] ? 'edit.compound' : 'edit.profile';
    $group['url'] = Pi::service('url')->assemble('user', array(
        'module'     => 'user',
        'controller' => 'profile',
        'action'     => $action,
        'group'      => $gid,
    ));
});
?>
<div class="clearfix">
    <div class="list-group">
        <?php if (Pi::service('module')->isActive('guide')) { ?>
            <?php $guideConfig = Pi::service('registry')->config->read('guide'); ?>
            <?php if ($guideConfig['manage_active']) { ?>
                <a title="Mes El&eacute;ments" href="<?php echo Pi::url($this->url('guide', array('module' => 'guide', 'controller' => 'manage', 'action' => 'dashboard'))); ?>" class="list-group-item<?php if (isset($sideActive) && $sideActive == 'dashboard') {echo ' active';} ?>">Mes El&eacute;ments</a>
                <?php if (Pi::service('module')->isActive('event')) { ?>
                    <a title="Mes Ev&egrave;nements" href="<?php echo Pi::url($this->url('event', array('module' => 'event', 'controller' => 'manage', 'action' => 'index'))); ?>" class="list-group-item<?php if ($module == 'event') {echo ' active';} ?>">Mes Ev&egrave;nements</a>
                <?php } ?>
                <?php if ($guideConfig['sponsor_active']) { ?>
                    <a title="Parrainage" href="<?php echo Pi::url($this->url('guide', array('module' => 'guide', 'controller' => 'manage', 'action' => 'sponsor'))); ?>" class="list-group-item<?php if (isset($sideActive) && $sideActive == 'sponsor') {echo ' active';} ?>">Parrainage</a>
                <?php } ?>
            <?php } ?>
        <?php } ?>

        <?php if (Pi::service('module')->isActive('favourite')) { ?>
            <a title="Mes Favoris" href="<?php echo Pi::url($this->url('guide', array('module' => 'guide', 'controller' => 'favourite', 'action' => 'index'))); ?>" class="list-group-item<?php if ($controller == 'favourite') {echo ' active';} ?>">Mes Favoris</a>
        <?php } ?>

        <?php if (Pi::service('module')->isActive('video')) { ?>
            <a title="<?php _e('My videos'); ?>" href="<?php echo Pi::url($this->url('video', array('module' => 'video', 'controller' => 'channel', 'action' => 'index'))); ?>" class="list-group-item<?php if ($module == 'video') {echo ' active';} ?>"><?php _e('My videos'); ?></a>
        <?php } ?>
    </div>

    <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
        <div class="panel panel-default">
            <div class="panel-heading" role="tab" id="headingOne">
                <h4 class="panel-title">
                    <a class="btn btn-primary btn-block collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                        <?php _e('My account')?> <span class='caret'></span>
                    </a>
                </h4>
            </div>

            <div id="collapseOne" class="panel-collapse collapse <?php if($module == 'user') echo 'in' ?>" role="tabpanel" aria-labelledby="headingOne">
                <div class="list-group">
                    <a href="<?php echo Pi::url($this->url('user', array('module' => 'user', 'controller' => 'account')));?>"
                       class="list-group-item<?php if($controller == 'account') { echo ' active'; } ?>">
                        <?php _e('Account settings')?>
                    </a>
                    <a href="<?php echo Pi::url($this->url('user', array('module' => 'user', 'controller' => 'password'))); ?>"
                       class="list-group-item<?php if($controller == 'password') { echo ' active'; } ?>">
                        <?php _e('Change password');?>
                    </a>
                    <a href="<?php echo Pi::url($this->url('user', array('module' => 'user', 'controller' => 'avatar'))); ?>"
                       class="list-group-item<?php if($controller == 'avatar') { echo ' active'; } ?>">
                        <?php _e('Change avatar');?>
                    </a>
                    <?php
                    foreach ($groups as $key => $group) {
                        ?>
                        <a href="<?php echo $group['url']; ?>"
                           class="list-group-item<?php if (isset($group_id)) { echo $group_id == $key ? ' active' : ''; } ?>">
                            <?php echo _escape($group['title']); ?>
                        </a>
                    <?php } ?>
                    <a href="<?php echo Pi::url($this->url('user', array('module' => 'user', 'controller' => 'privacy'))); ?>"
                       class="list-group-item<?php if($controller == 'privacy') { echo ' active'; } ?>">
                        <?php _e('Privacy'); ?>
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
