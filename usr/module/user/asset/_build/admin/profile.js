angular.module("userProfileModule").config(["$routeProvider","piProvider","config",function(a,b,c){function d(a){return c.assetRoot+a+".html"}a.when("/field",{templateUrl:d("profile-field"),controller:"fieldCtrl"}).when("/dress",{templateUrl:d("profile-dress"),controller:"dressCtrl",resolve:{data:["$q","server",function(a,b){var c=a.defer();return b.getDress().success(function(a){c.resolve(a)}),c.promise}]}}).when("/privacy",{templateUrl:d("profile-privacy"),controller:"privacyCtrl"}).otherwise({redirectTo:"/field"}),b.hashPrefix(),b.navTabs(c.navTabs),b.translations(c.t),b.ajaxSetup()}]).service("server",["$http","$cacheFactory","config",function(a,b,c){var d=c.urlRoot;this.getField=function(){return a.get(d+"field")},this.updateTitle=function(b){return a.post(d+"updateField",b)},this.getPrivacy=function(){return a.get(d+"privacy")},this.setPrivacy=function(b){return a.post(d+"setPrivacy",b)},this.getDress=function(){return a.get(d+"dressup")},this.saveDressUp=function(b){return a.post(d+"saveDressUp",{displays:b})}}]).controller("fieldCtrl",["$scope","server",function(a,b){b.getField().success(function(b){angular.extend(a,b),angular.forEach(a.compounds,function(a){angular.forEach(a.fields,function(b){b.compound=a.name})})}),a.$on("piHoverInputSave",function(a,c){b.updateTitle(c)})}]).controller("dressCtrl",["$scope","$route","$timeout","config","server","data",function(a,b,c,d,e,f){angular.forEach(f.compounds,function(a){a.$isEditing=0}),angular.forEach(f.displays,function(a){a.$isEditing=0}),angular.extend(a,f);var g=1;a.displaysOpts={handle:".pi-widget-header"},a.$watch("displays",function(b,c){b!==c&&(a.saveAlert={message:d.t.SAVE_TIP},g=0);var e=[];angular.forEach(b,function(a){a.name||e.push(a.title)}),a.customGroup=e},!0),a.addDisplayGroup=function(b){var c=a.compounds[b];a.displays.push(c),a.compounds.splice(b,1)},a.AddCustomDisplay=function(){var b=a.entity,c=!0;b&&(angular.forEach(a.displays,function(a){return a.title==b?c=!1:void 0}),c&&(a.displays.push({title:b,$isEditing:1,fields:[]}),a.entity=""))},a.AddGroupField=function(b,c){var d=a.profile[c];angular.forEach(a.displays,function(e){return e.title==b?(e.$isEditing=1,e.fields.push(d),a.profile.splice(c,1),!1):void 0})},a.removeGroupField=function(b,c){var d=b[c];a.profile.push(d),b.splice(c,1)},a.removeDisplay=function(b){var c=a.displays[b];a.displays.splice(b,1),c.name?a.compounds.push(c):a.profile=a.profile.concat(c.fields)},a.toggleGroup=function(a){a.$isEditing=!a.$isEditing},a.saveAction=function(){e.saveDressUp(a.displays),a.saveAlert="",g=1},a.cancelAction=function(){b.reload()},a.checkCustomGroup=function(){a.customGroup.length||(a.$parent.alert={status:0,message:d.t.CHECK_GROUP})};var h=d.t.LEAVE_CONFIRM;window.onbeforeunload=function(){return g?void 0:h},a.$on("$locationChangeStart",function(a){g||confirm(h)||a.preventDefault()})}]).controller("privacyCtrl",["$scope","server",function(a,b){a.limits=[{text:"public",value:0},{text:"member",value:1},{text:"follower",value:2},{text:"following",value:4},{text:"owner",value:255}],b.getPrivacy().success(function(b){a.fields=b}),a.setPrivacyAction=function(a){b.setPrivacy(a)},a.forcePrivacyAction=function(a){var c=a.is_forced;a.is_forced=c?0:1,b.setPrivacy(a).error(function(){a.is_forced=c})}}]);